Vagrant.configure("2") do |config|
    
    # prefix vms
    prefix_vms = "cdp-hadoop-"

    # Define the SSH user to use for provisioning
    #config.ssh.username = "universaluser"
    #config.ssh.private_key_path = "./ssh_keys/id_rsa"
    #config.ssh.password = "universaluser"

    # Synchroniser les dossiers
    config.vm.synced_folder "./ssh_keys", "/home/universaluser/ssh_keys"
    config.vm.synced_folder "./tmp_hosts", "/home/universaluser/tmp_hosts"
    

    # DÃ©finir le nombre de masters et de slaves
    masters_count = 1
    slaves_count = 1
    masters = (1..masters_count).map { |i| "#{prefix_vms}master-#{i}" }
    slaves = (1..slaves_count).map { |i| "#{prefix_vms}slave-#{i}" }
    
    # network params
    ip_counter = 24
    subnet_ip = "124.0.24"
    edge_ip = "124.0.24.100"
    db_server_ip = "124.0.24.101"
    cloudera_manager_server_ip = "124.0.24.102"
    
    # vm image config
    config.vm.box = "ubuntu/bionic64"
    #config.vm.network "forwarded_port", guest: 80, host: 8080

    # Scripts shell
    add_user_script = "./scripts/add_user.sh"
    ssh_passwordless_script = "./scripts/ssh_passwordless.sh"
    sync_hosts_script = "./scripts/sync_hosts.sh"
    update_hosts_script = "./scripts/update_hosts.sh"
  
  
    # Ajouter les machines de master
    masters.each do |name|
      config.vm.define name do |machine|
        machine.vm.hostname = name
        machine.vm.network "private_network", ip: "#{subnet_ip}.#{ip_counter}"
        ip_counter += 1
        machine.vm.provider "virtualbox" do |vb|
          vb.name = name
          vb.memory = "18432"
          vb.cpus = 8
        end
        # Utiliser les scripts de provisionnement
        machine.vm.provision "shell", path: add_user_script
        machine.vm.provision "shell", path: update_hosts_script
        #machine.vm.provision "shell", path: ssh_passwordless_script
      end
    end
  
    # Ajouter les machines de slave
    slaves.each do |name|
      config.vm.define name do |machine|
        machine.vm.hostname = name
        machine.vm.network "private_network", ip: "#{subnet_ip}.#{ip_counter}"
        ip_counter += 1
        machine.vm.provider "virtualbox" do |vb|
          vb.name = name
          vb.memory = "16384"
          vb.cpus = 8
        end
        # Utiliser les scripts de provisionnement
        machine.vm.provision "shell", path: add_user_script
        machine.vm.provision "shell", path: update_hosts_script
        #machine.vm.provision "shell", path: ssh_passwordless_script
      end
    end
  
    # Ajouter la machine edge
    config.vm.define "#{prefix_vms}edge" do |machine|
      machine.vm.hostname = "#{prefix_vms}edge"
      machine.vm.network "private_network", ip: "#{edge_ip}"
      machine.vm.provider "virtualbox" do |vb|
        vb.name = "#{prefix_vms}edge"
        vb.memory = "8192"
        vb.cpus = 8
      end
      # Utiliser les scripts de provisionnement
      machine.vm.provision "shell", path: add_user_script
      machine.vm.provision "shell", path: update_hosts_script
      #machine.vm.provision "shell", path: ssh_passwordless_script
    end

=begin     

    # Ajouter la machine db_server
    config.vm.define "#{prefix_vms}db-server" do |machine|
      machine.vm.hostname = "#{prefix_vms}db-server"
      machine.vm.network "private_network", ip: "#{db_server_ip}"
      machine.vm.provider "virtualbox" do |vb|
        vb.name = "#{prefix_vms}db-server"
        vb.memory = "4096"
        vb.cpus = 4
      end
      # Utiliser les scripts de provisionnement
      machine.vm.provision "shell", path: add_user_script
      machine.vm.provision "shell", path: update_hosts_script
      #machine.vm.provision "shell", path: ssh_passwordless_script
    end
  
    # Ajouter la machine cloudera_manager_server
    config.vm.define "#{prefix_vms}cloudera-manager-server" do |machine|
      machine.vm.hostname = "#{prefix_vms}cloudera-manager-server"
      machine.vm.network "private_network", ip: "#{cloudera_manager_server_ip}"
      machine.vm.provider "virtualbox" do |vb|
        vb.name = "#{prefix_vms}cloudera-manager-server"
        vb.memory = "8192"
        vb.cpus = 8
      end
      # Utiliser les scripts de provisionnement
      machine.vm.provision "shell", path: add_user_script
      machine.vm.provision "shell", path: update_hosts_script
      #machine.vm.provision "shell", path: ssh_passwordless_script
    end
//*/
=end    
    # Provisionner les hosts
    config.vm.provision "shell", path: sync_hosts_script, run: "always"
  end
  